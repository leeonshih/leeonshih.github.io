---
layout: post
title:  TK1 Usb3.0 Test
date:   2015-02-27 
categories: Hardware
tags: USB3.0 
---

### cyusb4linux安装
**2015-02-15**

需要g++支持
sudo apt-get install build-essential
需要QT4支持
sudo apt-get install qt4-dev-tools qt4-doc qt4-qtconfig qt4-demos qt4-designer
需要libusb支持     
sudo apt-get install libusb-dev libusb-1.0-0-dev

### cyusb4linux on TK1
**2015-02-27**

1. TK1上面ubuntu14.04不带有libusb库，并且无法通过apt-get install安装。因此，首先在网上下载了libusb的源代码。           
下载源码后解压到/home/cypress/libusb/目录
./configure
提示没有udev库支持，尝试用apt-get安装libudev-dev，不能安装，因此，查看configure的help，重新配置
./configure --disable-udev
然后      make，再然后      make  install
提示：在pc上 需要apt-get install libusb-dev libusb-1.0-0-dev，如果是下载源码编译安装，就是一个包
2. 有了libusb包之后，安装cyusb_linux_* 包，除了eclipse没有安装外（因为不要再ubuntu下开发固件），其他三个包都解压到 “/home/cypress/”下。     
安装java，安装g++支持。
然后make   “/src”目录下的测试程序。
第一步是提示 libcyusb库 imcompatible。cypress里边的libcyusb是编译好的，并且是x86上用的，因此，自然会 incompatible。lib路径下提供了源代码，重新编译一下
gcc libcyusb.c -fPIC -shared -o libcyusb.so.1
提示定义有冲突，查看libcyusb.h和libcyusb.c 两个文件，发现有函数的重载。于是将gcc改为g++，编译成功。  
g++ libcyusb.c -fPIC -shared -o libcyusb.so.1
按照 cyusb*根目录下的isntall.sh脚本，将 libcyusb.so.1拷贝到/usr/local/lib 中并建立 链接文件 libcyusb.s0    
再次 make “/src”目录下的测试程序
提示找不到 libusb-*** 等若干个函数，也就是说，这是libycusb已经可以用了，但是libusb还有问题，但是libusb编译都是操作正常的，baidu一下，这种报错主要是路径问题。
于是编辑一下Makefile文件。手动指想libusb的路径，在每一条编译指令的后边，增加 “-L  /usr/local/lib -l usb-1.0”,例如第儿行修改为
       g++ -o 00_fwload  00_fwload.c   -L ../lib -l cyusb -L /usr/local/lib -l usb-1.0
再次make，则程序能够正常编译完成，运行编译出的测试程序，发现提示找不到libcyusb.so。将libcyusb.so.1拷贝到“/usr/lib”中重新创建链接文件 libcyusb.so。
程序正常运行，测试程序跑通。

但是TK1板子上，官方提供的固件，无法识别USB3.0 host接口，只有2.0的接口，“lsusb -t”只能查看到2.0设备，即使插到3.0 host口的设备，列表中显示的也是2.0的接口和设备.

###   修改tk1 usb设置
**2015-02-28**

1. 在网上到处查资料，找人问，最后在TK1群里，网友“枫之舞”回复了。
TK1默认是关闭了USB3.0的，需要自己修改配置。配置有两处：
A，在下载的内核和文件系统，准备执行  ./apply_binaries.sh 之前， 修改跟目录下的   jetson-tk1.config   。里边有提示，需要配置一变量，默认是2.0的配置，改为3.0的配置之后，再执行 生成映像和下载的操作。

2. 下载完成后，在tk1系统里边，编辑 /boot/extlinux/extlinux.config 文件。 其中有一段：
commchip_id=0 usb_port_owner_info=0 
修改为  n9 0
commchip_id=0 usb_port_owner_info=2
然后重启tk1，即可看到port3已经变成了USB3.0 5000M。

