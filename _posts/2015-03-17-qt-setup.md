---
layout: post
title:  Qt库编译搭建
date:   2015-03-17 
categories: Devel
tags: Devel
---
<!--more-->
### Ubuntu上安装QT
QT版本说明[http://blog.csdn.net/l_yangliu/article/details/7459009](http://blog.csdn.net/l_yangliu/article/details/7459009)  
helloQT[http://www.linuxidc.com/Linux/2008-04/12322.htm](http://www.linuxidc.com/Linux/2008-04/12322.htm)  
Ubuntu 安装Qt4  
[http://www.cnblogs.com/aleny-liu/archive/2011/12/16/aleny-Qtnote1.html](http://www.cnblogs.com/aleny-liu/archive/2011/12/16/aleny-Qtnote1.html)  
[http://www.linuxidc.com/Linux/2011-05/36014.htm](http://www.linuxidc.com/Linux/2011-05/36014.htm)

### Ubuntu上安装QT交叉编译环境
host：Ubuntu12.04 64b  
开发板：IMX6 E9  
首先host已经安装了IMX6 arm芯片的交叉编译环境，并设置好路径。

### 安装tslib-1.4
我的安装路径是/usr/local/arm/qte/tslib/  
[http://blog.csdn.net/aifei7320/article/details/37955863](http://blog.csdn.net/aifei7320/article/details/37955863)  
使用 ./configure  --host=arm-linux  --prefix=/usr/local/arm/qte/tslib  --cache-file=arm-linux.cache 配置之后，make，make install。

修改ts.conf内容vi /usr/local/arm/qte/tslib/etc/ts.conf，将module_raw input前面的#去掉。


**问题:1：**  
我在编译过程中，出过fbutils.o 格式不对无法识别的问题，先是find，发现这个文件不是其他的库，而是tslib目录下自己的文件。用file命令查看，发现fbutils.o是X86格式的文件，应该是最先用错误的配置执行了make，导致这个问题先被pc 上的gcc编译了又没有更新替换，一直是X86格式的，所以用arm-linux-gcc编译链接的时候就说格式不对，后来make clean之后，再操作一遍，就成功生成了arm上用的tslib库。  
**问题2：**  
运行autogen.sh脚本的时候提示找不动东西，这个是PC里缺少包。 需要安装 apt-get install autoconf automake libtool
http://blog.sina.com.cn/s/blog_8173506f0100x95v.html

### 安装qt4.5
我的安装路径是/usr/local/arm/qt-4.5

[http://www.360doc.com/content/15/0108/10/20294498_439092480.shtml](http://www.360doc.com/content/15/0108/10/20294498_439092480.shtml)  
[http://blog.csdn.net/linfeng999/article/details/6446962](http://blog.csdn.net/linfeng999/article/details/6446962)

从Embedsky的光盘里拷贝出来qt-4.5的源码，解压之后，发现Embedsky提供了两个脚本，set_Armenv，arm_qt4.5_build。但是arm_qt4.5_build执行总是提示No rule to target ：install。我对脚本不太熟，没细查看，然后就没用Embedsky的脚本，而是查看了脚本里的 configure命令，将其全部拷贝出来，并且修改了  --prefix=/usr/local/arm/qt-4.5(我的安装路径)，在最末尾增加了 -I /usr/local/arm/qte/tslib/include -L /usr/local/arm/qte/tslib/lib -lrt  增加这部分命令，前面是为了让编译器找到我已经做好的tslib库，后面的 -lrt 是编译的时候有出错，网上查了一下，说把-lrt参数加上，具体是什么意思已经忘了。配置完成之后，make，make install。大概需要1.5~2个小时，编译完成。完成之后，进入一个简单的qt程序目录（就一个hello的窗口，已经在pc环境下运行过。）将源码之外所有代码清除，还没设置路径，就直接用命令   
```
/usr/local/arm/qt-4.5/qt\*\*\*/bin/qmake -project  
/usr/local/arm/qt-4.5/qt\*\*\*/bin/qmake -makefile    
make
```
完成后用file命令查看，已经得到了arm格式的二进制文件。

**问题1：**  
最早的时候，编译qt-4.5，到后半截提示一个demo程序找不到QtXml，然后报错退出。这是因为当时执行 configure时没有按照 脚本里的命令配置这么多参数，后来按照完整的参数配置之后就好了。  
**问题2：**  
编译qt的过程中提示 undefined reference to `clock_gettime’，这个是需要的configure时增加参数 -lrt，主要是没找到库librt.so  
[http://www.xuebuyuan.com/2053148.html](http://www.xuebuyuan.com/2053148.html)

### 配置arm板
将 /usr/local/arm 目录下生成的库拷贝到arm板上。然后配置好相关的路径

    export TSLIB_ROOT=/usr/local/arm/qte/tslib 
    
    export TSLIB_TSDEVICE=/dev/input/event0
    export LD_LIBRARY_PATH=$TSLIB_ROOT/lib:$LD_LIBRARY_PATH
    export TSLIB_FBDEVICE=/dev/fb0
    export TSLIB_PLUGINDIR=$TSLIB_ROOT/lib/ts
    export TSLIB_CONSOLEDEVICE=none
    export TSLIB_CONFFILE=$TSLIB_ROOT/etc/ts.conf
    export POINTERCAL_FILE=/etc/pointercal
    export TSLIB_CALIBFILE=/etc/pointercal
    export QWS_MOUSE_PROTO=TSLIB:/dev/input/event0
    export QTEDIR=/usr/local/arm/qt-4.5
    export PATH=/usr/local/arm/qt-4.5/bin:$PATH
    export LD_LIBRARY_PATH=/usr/local/arm/qt-4.5/lib:$LD_LIBRARY_PATH
    #export  ARMQTDIR=/usr/local/arm/qt-4.5
    #export  PATH=/usr/local/arm/qt-4.5/bin:$PATH
    export  MANPATH=/usr/local/arm/qt-4.5/man:$MANPATH
    #export  LD_LIBRARY_PATH=/usr/local/arm/qt-4.5/lib:$LD_LIBRARY_PATH

再执行程序

附：其他QT帖子
[http://www.gongkong.com/article/201501/56772.html](http://www.gongkong.com/article/201501/56772.html)  


### QT5.2 交叉编译环境搭建
大部分操作跟QT4.5类似。现在网上下载QT5.2的源码，然后按照标准流程  configure，make，make install三步走。

刚开始参考了两个帖子，又自己configure --help仔细研究了一下configure的参数，最后我的参数大概如下设置：

[http://blog.csdn.net/wdjhzw/article/details/41849383](http://blog.csdn.net/wdjhzw/article/details/41849383)  

        configure -v -prefix /usr/local/arm/qt-5.2 -release -opensource -make libs -xplatform linux-arm-gnueabi-g++ -optimized-qmake 
        -pch -qt-sql-sqlite -qt-libjpeg -qt-libpng -qt-zlib -no-opengl -no-sse2 -no-openssl -no-nis -no-cups -no-glib -no-xfixes -no-xrandr 
        -no-xrender -no-separate-debug-info -nomake examples -nomake tools -I /usr/local/arm/qte/tslib/include -L /usr/local/arm/qte/tslib/lib

configure之前，需要修改  qtbase/mkspecs/linux-arm-gnueabi-g++/qmake.conf（因为在 -xplatform参数里选择的这个），将其中的编译工具的路径修改为本机的实际情况。后面的两个帖子对编译参数有个大致说明可参考（细节的地方也没说太清楚）。 
[http://www.cnblogs.com/elect-fans/archive/2012/03/28/2420647.html](http://www.cnblogs.com/elect-fans/archive/2012/03/28/2420647.html)  
[http://www.cppblog.com/lauer3912/articles/136423.html](http://www.cppblog.com/lauer3912/articles/136423.html)  
编译完成后将 /usr/local/arm/qt-5.2 整个拷贝到arm板子上，然后编译运行程序，下载到板子上，使用命令

        test -platform linuxfb

即可运行。

**问题1：**  
最早的时候编译了很多遍都没有成功，应该是每次编译了，再配置编译之前需要clean一下，没做这个操作，最后总是提示找不到头文件。后来为了省的出错，每次都是删掉整个文件夹解压重新操作。  
**问题2：**  
qt4都是  test -qws执行，现在qt5更改了架构，因此在执行的时候，需要 -platform参数，最先测试的时候，没有正确输入参数，导致以为执行不正确。



